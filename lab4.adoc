= Отчет №4
:toc:
:toc-title: Оглавление
:toclevels: 3
:sectnums:

include::titul.adoc[]

== Что такое операционная система

Операционная система — это программа, которая помогает пользователю и прикладным приложениям взаимодействовать с «железом» — памятью, процессором, файлами и периферией.

=== Основные функции ОС

|===
| Функция | Что делает

| Управление процессором | Определяет, какая задача сейчас будет выполняться
| Работа с памятью        | Выделяет и освобождает оперативную память
| Файловая система        | Обеспечивает создание, запись и чтение файлов
| Ввод/вывод              | Настраивает доступ к устройствам (например, клавиатуре или дисплею)
| Интерфейс пользователя  | Предоставляет командную строку или графический рабочий стол
|===

== Операционные системы реального времени (ОСРВ)

В таких системах особенно важно, чтобы задачи выполнялись не только правильно, но и **в нужное время**.

Если задача среагирует слишком поздно — это может привести к сбою или аварии. Поэтому в ОСРВ всё строится вокруг предсказуемости (детерминированности) и минимальных задержек.

=== Классификация ОСРВ

|===
| Тип | Особенности

| Жёсткого реального времени | Временные ограничения нарушать нельзя — например, системы в самолётах или медицинском оборудовании.
| Мягкого реального времени  | Можно немного опаздывать — например, при воспроизведении видео.
|===

== Многозадачность

Многозадачность — это когда ОС может запускать несколько задач "одновременно".

=== Виды многозадачности

* **Кооперативная** — задача сама решает, когда уступить управление.
* **Вытесняющая** — ОС сама прерывает текущую задачу, если нужно переключиться.

== Планировщик задач

Планировщик — это компонент ОС, который решает, какая задача будет выполняться в каждый момент времени.

=== На что он смотрит

* Приоритет задачи
* Время, сколько задача ждёт
* Алгоритм планирования, установленный ОС

В ОСРВ чаще всего используется *вытесняющий планировщик с приоритетами* — чтобы важные задачи всегда запускались вовремя.

=== Как работает планировщик?

Планировщик анализирует список всех задач и выбирает ту, которая *имеет самый высокий приоритет* и *готова к выполнению*. Если активная задача внезапно стала менее приоритетной, она может быть *вытеснена* планировщиком, и управление передаётся более важной задаче.

Планировщик также может учитывать другие параметры:

- таймауты ожидания (для задач, ждущих ресурс),
- случаи одинаковой приоритетности задач,
- события синхронизации (например, семафоры, очереди, флаги).

=== Когда вызывается планировщик?

Планировщик ОС вызывается в следующих случаях:

* Когда завершается текущая задача.
* Когда задача **переходит в состояние ожидания** (например, `osDelay()`, `wait()`).
* Когда **появляется задача более высокого приоритета** — например, по прерыванию.
* При **освобождении ресурса**, на который ждали другие задачи.
* При явном вызове функции планирования, если ОС это допускает (например, `taskYIELD()` в FreeRTOS).


== Что такое FreeRTOS

FreeRTOS — это маленькая и удобная операционная система реального времени, которую можно использовать в проектах с микроконтроллерами (в том числе ARM Cortex-M).

|===
| Свойство | Что это значит

| Маленький размер | Занимает минимум памяти (подходит для встраиваемых устройств)
| Гибкость | Подходит под разные микроконтроллеры
| Простота | Есть удобные функции для создания задач, очередей, мьютексов и пр.
|===

== Как задачи взаимодействуют

Когда задач несколько, они должны **обмениваться данными** и **согласовывать действия**, чтобы не мешать друг другу.

=== Механизмы взаимодействия

* Очереди
* Семафоры
* Мьютексы
* События
* Уведомления задач
* Потоки сообщений

Эти механизмы позволяют избежать конфликтов и синхронизировать работу.

== Что такое задача в FreeRTOS

Задача — это блок кода, который может выполняться отдельно от других.

* Создаётся с помощью `CreateThread()` т.е. `Rtos::CreateThread(buttonTask, "buttonTask", OsWrapper::ThreadPriority::aboveNormal);`
* У каждой задачи есть **приоритет**
* FreeRTOS переключает задачи автоматически (вытесняющая многозадачность)

[NOTE]
====
В проекте используется **специальная обёртка над FreeRTOS** — `RtosWrapper`.  
Она упрощает взаимодействие с задачами, скрывая прямые вызовы FreeRTOS API и делая код более читаемым и переносимым.
====

== Когда отключают планировщик и прерывания

Обычно это делают в особых случаях:

* Во время старта системы (инициализация)
* В критических секциях (где нельзя допустить переключение задач)
* Чтобы временно «заморозить» выполнение, например, при обновлении конфигурации

[NOTE]
====
Отключения должны быть **короткими**, иначе могут нарушиться временные гарантии.
====

== Мьютексы и защита ресурсов

Мьютекс — это механизм, который **гарантирует, что только одна задача в конкретный момент получит доступ к какому-то ресурсу** (например, к UART или файлу).

Преимущества мьютексов:

* Только один "владелец" в конкретный момент
* Поддержка **наследования приоритета** — чтобы избежать приоритетного инверсирования
* Возможность создания **рекурсивных мьютексов**, если одна и та же задача несколько раз захватывает ресурс

== Что такое дедлок (Deadlock)

Дедлок — это ситуация, когда несколько задач ждут друг друга бесконечно и ничего не происходит.

=== Причины дедлоков

* Задачи захватывают ресурсы в разном порядке
* Не освобождают ресурсы вовремя
* Используют вложенные блокировки без контроля

=== Как избежать

* Использовать **тайм-ауты** при попытке захвата ресурса
* Соблюдать **одинаковый порядок** обращения к ресурсам
* Избегать вложенных `lock`-ов, если в них нет необходимости

== Выводы

На этой лабораторной я познакомилась с основами работы операционных систем реального времени и поняла:

* Чем отличаются жёсткие и мягкие ОСРВ;
* Как устроен планировщик и какие бывают типы многозадачности;
* Зачем нужны мьютексы и семафоры;
* Что такое дедлок и как его избежать;
* Почему точность выполнения задач — важнейшее требование к любой RTOS.

Теперь мне стало яснее, как встроенные системы управляют многими процессами параллельно и безопасно.
